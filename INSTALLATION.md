# Dekode Project Base

Dekode Project Base is based on Bedrock, a modern WordPress stack that helps you get started with the best development tools and project structure.

Much of the philosophy behind Bedrock is inspired by the [Twelve-Factor App](http://12factor.net/) methodology including the [WordPress specific version](https://roots.io/twelve-factor-wordpress/).

## Features

* Better folder structure
* Dependency management with [Composer](http://getcomposer.org)
* Easy WordPress configuration with environment specific files
* Environment variables with [Dotenv](https://github.com/vlucas/phpdotenv)

## Requirements

* PHP >= 7.0
* Composer - [Install](https://getcomposer.org/doc/00-intro.md#installation-linux-unix-osx)

## Installation

*Note: If you are using Local by Flywheel, please follow the instructions in the next section.*

1. Create a new project in a new folder for your project:

  `composer create-project dekode/project-base your-project-folder-name`

2. Update environment variables in `.env`  file:
  * `DB_NAME` - Database name
  * `DB_USER` - Database user
  * `DB_PASSWORD` - Database password
  * `DB_HOST` - Database host
  * `WP_ENV` - Set to environment (`development`, `staging`, `production`)
  * `WP_HOME` - Full URL to WordPress home (http://example.com)
  * `WP_SITEURL` - Full URL to WordPress including subdirectory (http://example.com/wp)
  * `AUTH_KEY`, `SECURE_AUTH_KEY`, `LOGGED_IN_KEY`, `NONCE_KEY`, `AUTH_SALT`, `SECURE_AUTH_SALT`, `LOGGED_IN_SALT`, `NONCE_SALT`

  If you want to automatically generate the security keys (assuming you have wp-cli installed locally) you can use the very handy [wp-cli-dotenv-command][wp-cli-dotenv]:

      wp package install aaemnnosttv/wp-cli-dotenv-command

      wp dotenv salts regenerate

  Or, you can cut and paste from the [Roots WordPress Salt Generator][roots-wp-salt].

3. Add theme(s) in `public/content/themes` as you would for a normal WordPress site.

4. Access WP admin at `http://example.com/wp/wp-admin`

## Local by Flywheel Installation

1. Create a new site in the Local app using Custom settings.

  Note that if you use preferred settings, the setup script will fail because preferred does not create the `/conf` folder required by project-base.

2. `cd` to the site app folder and `rm -rf public` to remove the `/public` folder automatically generated by Local.

3. While in the `/app` folder, clone Dekode Project Base using `git clone git@github.com:DekodeInteraktiv/project- base.git .`.

4. Restart the site in Local.

5. Follow the normal installation instructions.

## Alternative Local by Flywheel installation
This method uses the local by flywheel wordpress installation and settings rather than overriding everything with the project base.

1. Create a site in Local By Flywheel. Use any settings, can be changed later. But make sure multisite is selected if needed.

2. `cd` to the site app folder, (don't remove the public folder). and run `composer create-project dekode/project-base your-project-folder-name`. The project folder name should be the same name as the projects git name.

3. `cd` into public and `rm -rf wp-content` to remove the `wp-content` folder. Then run `ln -s ../your-project-folder-name/web/app wp-content` or `mklink /d wp-content ..\your-project-folder-name\web\app`. To create a symlink from wp-content to the projects content folder.

4. `cd` back inte your project folder `cd ../your-project-folder-name` and run `composer install`

5. All done. you don't need to touch .env files and no need to go into the public folder again, other than to add wp-constants if needed. Changing settings, environments, wp-versions and so on can be done from the Local By Flywheel GUI.

## Deploys
`composer install` must be run as part of the deploy process.

## Documentation

Bedrock documentation is available at [https://roots.io/bedrock/docs/](https://roots.io/bedrock/docs/).

[roots-wp-salt]:https://roots.io/salts.html
[wp-cli-dotenv]:https://github.com/aaemnnosttv/wp-cli-dotenv-command



## Recent alterative with Local

1. Create a site `sample1` with Local inside your regular projects folder (named as `$PATH` below in the commands)
You will endup with a folder that contains 
- app 
- conf 
- logs

2. Open the terminal and run the commands
$ `cd $PATH/sample1/app`
$ `composer create-project dekode/project-base sample1`

At this point you should have a structure like:
- app 
	- public
	- sample1
- conf 
- logs

If at this step you get any errors, check the constrains, 
update the composer file and run the install command:

`$ cd sample1/`
`$ composer install`
`$ cd ../public/`
`$ rm -rf wp-content`

Local is running WordPress from public folder, so we need to symlink the project folder content to the WordPress content

`$ ln -s $PATH/sample1/app/sample1/public/content/ $PATH/sample1/app/public/wp-content`

If that worked, check the site. 

**IMPORTANT!** The theme is not activated, you will see the WSOD.
Login to admin and activate the theme.

**NOTE!**
The theme that comes with the project setup is built, and cannot be used for development. 

@TODO - make this easy, with commands.
To get a functional / development-ready theme, setup locally the teft project, pull from master, find the theme, copy that in your project, test if the composer and packages can be installed, run the build commands
